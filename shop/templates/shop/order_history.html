{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Order History - StyleVerse{% endblock %}

{% block content %}
<h2>My Order History</h2>

<div class="order-history-container">
  {% if page_obj %}
    {% for order in page_obj %}
      <div class="order-block">
        <p>
          <strong>Order ID:</strong> {{ order.id }} | 
          <strong>Date:</strong> {{ order.created_at|date:"Y-m-d H:i" }} | 
          <strong>Status:</strong> {{ order.status }}
        </p>

        {% for item in order.items.all %}
          <div class="product-review-block">
            <p><strong>{{ item.product.name }}</strong></p>

            {% if order.status == 'Delivered' %}
              {% if item.product.id in reviewed_products %}
                <p class="already-reviewed">You already reviewed this product.</p>
              {% else %}
                <a href="{% url 'shop:add_review' item.product.id %}" class="btn">Write a Review</a>
              {% endif %}
            {% else %}
              <p>Review available after delivery.</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}

    <!-- Pagination -->
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}">« Prev</a>
      {% endif %}

      <span class="current-page">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next »</a>
      {% endif %}
    </div>
  {% else %}
    <p>You have no past orders.</p>
  {% endif %}
</div>
{% endblock %}