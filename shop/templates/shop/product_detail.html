{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="product-detail">

  <!-- Gallery Section -->
  <div class="gallery-section">
    <!-- Thumbnails -->
    <div class="thumbnails">
      {% if product.images.exists %}
        {% for img in product.images.all %}
          <img src="{{ img.image.url }}" class="thumb" alt="{{ product.name }}">
        {% endfor %}
      {% else %}
        <img src="{% static 'images/placeholder-product.jpg' %}" class="thumb" alt="No Image">
      {% endif %}
    </div>

    <!-- Main Image with navigation -->
    <div class="main-image-container">
      <button class="nav-btn left">&#10094;</button>
      {% if product.images.first %}
        <img id="mainPreview" src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
      {% else %}
        <img id="mainPreview" src="{% static 'images/placeholder-product.jpg' %}" alt="No Image">
      {% endif %}
      <button class="nav-btn right">&#10095;</button>
    </div>
  </div>

  <!-- Product Info -->
  <div class="product-info">
    <h2>{{ product.name }}</h2>
    <p class="description">{{ product.description }}</p>
    <p class="price">₦{{ product.price|intcomma }}</p>

    {% if reviews.exists %}
      <p class="rating">⭐ {{ avg_rating|floatformat:1 }}/5</p>
    {% endif %}

    <!-- Add to Cart Form -->
    <form method="POST" action="{% url 'shop:add_to_cart' product.id %}">
      {% csrf_token %}
      {% if product.size_list.exists %}
        <label for="size">Size:</label>
        <select name="size" id="size" required>
          {% for size in product.size_list %}
            <option value="{{ size.name }}">{{ size.name }}</option>
          {% endfor %}
        </select>
      {% endif %}

      {% if product.color_list.exists %}
        <label for="color">Color:</label>
        <select name="color" id="color" required>
          {% for color in product.color_list %}
            <option value="{{ color.name }}">{{ color.name }}</option>
          {% endfor %}
        </select>
      {% endif %}

      <label for="quantity">Quantity:</label>
      <input type="number" name="quantity" value="1" min="1">
      <button type="submit" class="btn add-to-cart-btn">Add to Cart</button>
      <a href="{% url 'shop:cart' %}" class="btn">View Cart</a>
    </form>

    <!-- Wishlist -->
    <form method="POST" action="{% url 'shop:add_to_wishlist' product.id %}" style="margin-top:10px;">
      {% csrf_token %}
      <button type="submit" class="btn wishlist-btn">♡ Add to Wishlist</button>
    </form>

    <button class="btn btn-secondary" onclick="window.history.back()">Go Back</button>

    <!-- Reviews -->
    <div class="reviews">
      <h3>Customer Reviews</h3>
      {% if reviews.exists %}
        {% for review in reviews %}
          <div class="review">
            <strong>{{ review.user.username }}</strong> – ⭐ {{ review.rating }}/5
            <p>{{ review.comment }}</p>
            <small>{{ review.created_at|naturaltime }}</small>
          </div>
        {% endfor %}
      {% else %}
        <p>No reviews yet.</p>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/script.js' %}"></script>
{% endblock %}